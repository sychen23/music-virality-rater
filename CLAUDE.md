# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Soundcheck** — a music virality rater web application. Early-stage project with UI scaffolding, authentication, and database infrastructure in place.

## Commands

```bash
bun dev          # Start dev server (localhost:3000)
bun run build    # Production build
bun run lint     # ESLint (next core-web-vitals + typescript)
bun start        # Start production server
```

Database (requires `docker compose up -d` for local Postgres on port 5434):
```bash
bun run db:generate   # Generate Drizzle migrations from schema
bun run db:migrate    # Run migrations
bun run db:push       # Push schema directly (dev shortcut)
bun run db:studio     # Open Drizzle Studio GUI
```

Add shadcn components:
```bash
bunx shadcn@latest add <component-name>
```

## Tech Stack

- **Next.js 16** with App Router (RSC enabled)
- **React 19** with TypeScript (strict mode)
- **Tailwind CSS v4** via `@tailwindcss/postcss` (no `tailwind.config` file — config is CSS-based in `app/globals.css`)
- **shadcn/ui** using the `radix-nova` style, with `radix-ui` primitives and `class-variance-authority`
- **Hugeicons** (`@hugeicons/react` + `@hugeicons/core-free-icons`) as the icon library — not Lucide
- **Drizzle ORM** with `postgres.js` driver, migrations in `db/migrations/`
- **better-auth** for authentication with Google OAuth social provider
- **AI SDK** (`ai` + `@ai-sdk/react`) with Zod for validation
- **bun** as the package manager (lockfile: `bun.lock`)

## Architecture

### App & Layout

- `app/layout.tsx` — Root layout wraps everything in `AuthProvider` and renders `AuthModal` globally. Uses `next/font/google` for Inter, Geist, and Geist Mono fonts.
- `app/api/auth/[...all]/route.ts` — better-auth catch-all API route handler.
- `proxy.ts` — Next.js middleware for auth redirects (protects `/dashboard/*`, redirects authenticated users away from `/login`).

### Authentication (action-gated pattern)

The app is fully browsable without login. Actions are gated via `requireAuth()`:

- `lib/auth.ts` — Server-side better-auth config with Drizzle adapter.
- `lib/auth-client.ts` — Client-side auth exports: `signIn`, `signOut`, `signUp`, `useSession`.
- `lib/auth-session.ts` — Server-side `getSession()` helper (uses `headers()` from Next.js).
- `components/auth-provider.tsx` — `AuthProvider` context + `useAuth()` hook. Provides `session`, `user`, `isPending`, `openAuthModal`, `closeAuthModal`, `requireAuth`.
- `components/auth-modal.tsx` — Global sign-in dialog (Google OAuth). Controlled by AuthProvider state.

To gate any action behind auth:
```tsx
const { requireAuth } = useAuth()
<Button onClick={() => requireAuth(() => { /* runs only if logged in */ })}>Action</Button>
```

### Database

- `docker-compose.yml` — Local Postgres (port 5434, user/pass: soundcheck/doublesoundcheck).
- `lib/db.ts` — Drizzle client instance with schema.
- `db/schema.ts` — Drizzle schema (user, session, account, verification tables + relations).
- `drizzle.config.ts` — Drizzle Kit config, migrations output to `db/migrations/`.

### UI Components

- `components/ui/` — shadcn/ui primitives (generated by CLI — avoid manual edits).
- `components/` — App-level components.
- `lib/utils.ts` — `cn()` helper (clsx + tailwind-merge).

## Path Aliases

`@/*` maps to the project root (configured in `tsconfig.json`).

## Environment Variables

See `.env.example`:
- `BETTER_AUTH_SECRET` / `BETTER_AUTH_URL` — better-auth config
- `GOOGLE_CLIENT_ID` / `GOOGLE_CLIENT_SECRET` — Google OAuth credentials
- `DATABASE_URL` — Postgres connection string

## Conventions

- shadcn components use `data-slot` attributes for styling hooks.
- Icons: use `<HugeiconsIcon icon={SomeIcon} strokeWidth={2} />` pattern — import icons from `@hugeicons/core-free-icons`.
- CSS theming uses oklch color space with CSS custom properties and light/dark mode support (`.dark` class).
- Server-side session checks use `getSession()` from `lib/auth-session.ts`. Client-side uses `useAuth()` from `components/auth-provider.tsx`.
